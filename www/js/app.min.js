"use strict";function merge_objects(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}function searchBox(a){return{restrict:"E",templateUrl:"modules/partials/search-box.html",replace:!0,link:function(b){b.navSearch=function(c){return a.findRestaurant(c).then(function(a){a.length||a.push({formatted:"no results found"});var c={};return angular.forEach(b.filterOut,function(a){c[a.id]=!0}),a.map(function(a){if("no results found"!==a.formatted){var b=a.formatted.split(" - ");a.searchText=b[0];var c=b[1].split(":");a.tag=c[0],a.tagValue=c[1]}return a}).filter(function(a){return a&&a.data?!c[a.data.id]:!0})})}},scope:{setRestaurant:"&",placeholder:"@",filterOut:"="}}}function shareLinks(a){return{link:function(b,c,d){var e,f,g=["twitter","facebook","linkedin","google-plus"],h=d.shareLinks.toLowerCase().split(","),i=encodeURIComponent(a.absUrl()),j=d.shareTitle,k=encodeURIComponent(j),l=[];for(angular.forEach(h,function(a){switch(a=a.trim()){case"twitter":f="http://twitter.com/intent/tweet?text="+k+"%20"+i;break;case"facebook":f="http://facebook.com/sharer.php?u="+i;break;case"linkedin":f="http://www.linkedin.com/shareArticle?mini=true&url="+i+"&title="+k;break;case"google-plus":f="https://plus.google.com/share?url="+i}g.indexOf(a)>-1&&l.push({network:a,url:f})}),b.openWindow=function(a){alert(a),alert(l[a].url)},e=0;e<l.length;e++){var m="";m+='<a class="pointer" onclick="window.open(\''+l[e].url+"', '_blank', 'width=550,height=450,toolbar=0,location=0,menubar=0')\" ",m+='><i width="36" height="36" title="Share" class="share-button fa fa-'+l[e].network+'"></a>',c.append(m)}}}}var rxControllers=angular.module("Controllers",["ngRoute"]);rxControllers.config(["$routeProvider",function(a){a.when("/index",{templateUrl:"modules/home/views/index.html",controller:"indexCtrl"}).when("/index/:view",{templateUrl:"modules/home/views/index.html",controller:"indexCtrl"}).when("/dashboard/:restaurantId",{templateUrl:"modules/restaurant/views/owner.html",controller:"detailCtrl",access:{requiredLogin:!0}}).when("/manage/photos/:restaurantId",{templateUrl:"modules/photo/views/index.html",controller:"photoCtrl",access:{requiredLogin:!0}}).when("/request/change/:restaurantId",{templateUrl:"modules/request/views/index.html",controller:"requestCtrl",access:{requiredLogin:!0}}).when("/compare",{templateUrl:"modules/compare/views/index.html",controller:"compareCtrl",access:{requiredLogin:!0}}).when("/widgets",{templateUrl:"modules/widgets/views/index.html",controller:"widgetsCtrl",access:{requiredLogin:!0}}).when("/restaurant/:restaurantId",{templateUrl:"modules/restaurant/views/detail.html",controller:"detailCtrl"}).when("/login",{templateUrl:"modules/login/views/loginFull.html",controller:"loginCtrl"}).when("/login/signup",{templateUrl:"modules/login/views/signUp.html",controller:"loginCtrl"})}]).factory("searchData",function(){var a={};return{get:function(){return a},set:function(b){a=b}}}).controller("indexCtrl",["$scope","$rootScope","$http","localStorageService","$location","restaurantSvr","userSvr","geoLocation","$routeParams","$anchorScroll","searchData",function(a,b,c,d,e,f,g,h,i,j){function k(b,c){b=b?merge_objects(a.restaurantList.params,b):a.restaurantList.params,a.cgBusyPromise=f.getRestaurants(b),a.cgBusyPromise.then(function(d){if(0==d.items.length&&0!=a.distanceFilterValue&&c){for(var e=1;e<a.distanceFilterOptions.length-1;e++){if(e==a.distanceFilterOptions.length-2){a.distanceFilterValue=0,a.setDistanceFilter(a.distanceFilterValue);break}if(a.distanceFilterOptions[e].value==a.distanceFilterValue){a.distanceFilterValue=a.distanceFilterOptions[e+1].value,a.setDistanceFilter(a.distanceFilterValue);break}}k(b,c)}else a.restaurants=d.items,a.maxSize=6,a.popularListItemPerPage=8,a.popularListTotalItems=d._meta.totalCount,a.restaurantList.page=d._meta.currentPage,a.numPages=d._meta.pageCount})}function l(){a.sidebar="modules/partials/sidebar.html",a.header="modules/partials/header.html",a.footer="modules/partials/footer.html"}function m(){f.getRestaurantCategories().then(function(b){a.allCategories=b})}i.view?"favorites"==i.view?a.view="favorites":e.path("/index"):a.view="index",a.init=function(){if(a.$watch("user",function(){a.user&&a.user.ownedRestaurants&&a.user.ownedRestaurants.length&&f.getRestaurants({"id-in":a.user.ownedRestaurants.join(),"per-page":50}).then(function(b){a.ownedRestaurants=b.items}),a.user&&"favorites"==a.view&&g.getFavorites().then(function(b){a.favoriteRestaurants=b})}),a.restaurantList={page:1,params:{sort:"popular","price_range-greater-than-or-equal-to":0,"price_range-less-than-or-equal-to":4,"distance-less-than-or-equal-to":1}},l(),a.listedCategories={Indian:!1,"Indonesian Restaurant":!1,Thai:!1,Italian:!1,Cafe:!1,"Modern Australian":!1,African:!1,Vegetarian:!1},a.allCategoriesSelected=!0,a.ratingFilterValue=0,a.trendFilterValue=0,a.distanceFilterValue=1,a.priceFilterOptions=[{label:"$",value:0},{label:"$$",value:1},{label:"$$$",value:2},{label:"$$$$",value:3},{label:"$$$$$",value:4}],a.ratingFilterOptions=[{label:"All ratings",value:0},{label:"Less than 60%",value:1},{label:"Greater than 60%",value:60},{label:"Greater than 70%",value:70},{label:"Greater than 80%",value:80},{label:"Greater than 90%",value:90}],a.distanceFilterOptions=[{label:"Any distance",value:0},{label:"Less than 1 KM",value:1},{label:"Less than 2 KM",value:2},{label:"Less than 5 KM",value:5},{label:"Less than 10 KM",value:10},{label:"Greater than 10 KM",value:-10}],a.trendFilterOptions=[{label:"All",value:0},{label:"Less than 60%",value:1},{label:"Greater than 60%",value:60},{label:"Greater than 70%",value:70},{label:"Greater than 80%",value:80},{label:"Greater than 90%",value:90}],a.sortOptions=[{label:"Rating",value:"popular",direction:"bottom"},{label:"Trend",value:"trending",direction:"bottom"},{label:"Distance",value:"distance",direction:"top"}],m(),a.setAutoLocation(!i.formattedAddress),i.search){var b={};i.formattedAddress&&(b["formatted-address"]=i.formattedAddress),i.priceRange&&(b.price_range=i.priceRange),i.category&&(b.category=i.category),a.restaurantList.params=merge_objects(a.restaurantList.params,b),k()}a.avatarOptions={animate:{duration:1e3,enabled:!0},barColor:"#428bca",size:60,scaleColor:!1,lineWidth:5,lineCap:"circle"},a.$watch("restaurantList.params",function(){k()},!0),a.$watch("listedCategories",function(){var b=null;angular.forEach(a.listedCategories,function(a,c){a===!0&&(null===b?b=c:b+=","+c)}),a.restaurantList.params["category-in"]=b,null==b&&delete a.restaurantList.params["category-in"]},!0)},a.setAutoLocation=function(b){a.nearMe=b,b===!0?d.get("latitude")&&d.get("longitude")?k(null,!0):h.getLocation().then(function(a){d.add("latitude",a.coords.latitude),d.add("longitude",a.coords.longitude),k(null,!0)}):(d.remove("latitude"),d.remove("longitude"),k(null,!1))},a.popularListPageChanged=function(){var b=a.restaurantList.page;k({page:b})},a.options={animate:{duration:1e3,enabled:!0},barColor:"#428bca",size:60,scaleColor:!1,lineWidth:5,lineCap:"circle"},a.selectAllCategories=function(){angular.forEach(a.listedCategories,function(b,c){a.listedCategories[c]=!1})},a.addCategory=function(b){a.listedCategories[b]=!0},a.setRatingFilter=function(b){0==b?(delete a.restaurantList.params["percentile-greater-than-or-equal-to"],delete a.restaurantList.params["percentile-less-than-or-equal-to"]):1==b?(delete a.restaurantList.params["percentile-greater-than-or-equal-to"],a.restaurantList.params["percentile-less-than-or-equal-to"]=60):(delete a.restaurantList.params["percentile-less-than-or-equal-to"],a.restaurantList.params["percentile-greater-than-or-equal-to"]=b)},a.setTrendFilter=function(b){0==b?(delete a.restaurantList.params["trend-greater-than-or-equal-to"],delete a.restaurantList.params["trend-less-than-or-equal-to"]):1==b?(delete a.restaurantList.params["trend-greater-than-or-equal-to"],a.restaurantList.params["trend-less-than-or-equal-to"]=60):(delete a.restaurantList.params["trend-less-than-or-equal-to"],a.restaurantList.params["trend-greater-than-or-equal-to"]=b)},a.setDistanceFilter=function(b){0==b?(delete a.restaurantList.params["distance-greater-than-or-equal-to"],delete a.restaurantList.params["distance-less-than-or-equal-to"]):0>b?(delete a.restaurantList.params["distance-less-than-or-equal-to"],a.restaurantList.params["distance-greater-than-or-equal-to"]=-b):(delete a.restaurantList.params["distance-greater-than-or-equal-to"],a.restaurantList.params["distance-less-than-or-equal-to"]=b)},a.toggleFiltersMobile=function(){a.showFiltersMobile=!a.showFiltersMobile,a.scrollTop()},a.scrollTop=j,a.init()}]).controller("navigationController",["$scope","$http","$location",function(a,b,c){a.setRestaurant=function(a){a&&a.data&&a.data.id&&c.path("/restaurant/"+a.data.id)}}]).controller("searchCtrl",["$scope","$http","$location","$routeParams","restaurantSvr","searchData",function(a,b,c,d,e,f){a.restaurantList={},a.search={},e.getRestaurantCategories().then(function(b){a.categories=b}),a.prices=[{value:"$",numericValue:0},{value:"$$",numericValue:1},{value:"$$$",numericValue:2},{value:"$$$$",numericValue:3},{value:"$$$$$",numericValue:4}],a.getLocation=function(a){return b.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:a,sensor:!1}}).then(function(a){return a.data.results.map(function(a){return{formatted_address:a.formatted_address,location:a.geometry.location}})})},d.search&&(a.search=f.get()),a.searchRestaurant=function(){f.set(a.search);var b="/index";(a.search.formattedAddress||a.search.price||a.search.category)&&(b+="?search=true"),a.search.formattedAddress&&(b+="&formattedAddress="+a.search.formattedAddress),a.search.price&&(b+="&priceRange="+a.search.price),a.search.category&&(b+="&category="+a.search.category),c.url(b)}}]).controller("mapCtrl",["$scope","locationSvr","$modal","$routeParams","$log","localStorageService",function(a,b,c,d,e,f){var g=f.get("latitude"),h=f.get("longitude");a.originAddress="",a.map={};var i=new google.maps.Geocoder;a.getMap=function(){b.getLocation(d.restaurantId).then(function(b){a.map={center:{latitude:b.lat,longitude:b.long},zoom:17,formattedAddress:b.formatted_address,control:{}},a.options={scrollwheel:!1},a.coordsUpdates=0,a.dynamicMoveCtr=0,a.marker={id:0,coords:{latitude:a.map.center.latitude,longitude:a.map.center.longitude}},a.$watchCollection("marker.coords",function(b,c){_.isEqual(b,c)||a.coordsUpdates++});a.directions={origin:g+","+h,destination:a.map.center.latitude+","+a.map.center.longitude,showList:!0};a.travelModes=[{label:"Driving",value:"DRIVING"},{label:"Walking",value:"WALKING"},{label:"Bicycling",value:"BICYCLING"},{label:"Transit",value:"TRANSIT"}],a.travelMode=a.travelModes[0].value;var c=new google.maps.LatLng(g,h);i.geocode({latLng:c},function(b,c){c==google.maps.GeocoderStatus.OK?b[1]?(a.originAddress=b[1].formatted_address,a.getDirections(a.travelMode)):console.log("No location found"):console.log("Geocoder failed due to: "+c)})})},a.getDirections=function(b){var c=new google.maps.DirectionsRenderer,d=new google.maps.DirectionsService,e={origin:a.directions.origin,destination:a.directions.destination,travelMode:google.maps.DirectionsTravelMode[b]};d.route(e,function(b,d){if(d===google.maps.DirectionsStatus.OK){c.setDirections(b),c.setMap(a.map.control.getGMap());for(var e=document.getElementById("directionsList");e.hasChildNodes();)e.removeChild(e.firstChild);c.setPanel(document.getElementById("directionsList")),a.directions.showList=!0,a.routeMessage=""}else a.routeMessage="Google route unsuccessful"})},a.getMap()}]).controller("menuCtrl",["$scope","$routeParams",function(a,b){a.restaurantId=b.restaurantId,void 0!==a.restaurantId&&a.restaurantId&&(a.menus=[{name:"Manage Photos",link:"#/manage/photos/"+a.restaurantId,icon:"i-docs"},{name:"Dashboard",link:"#/dashboard/"+a.restaurantId,icon:"i-statistics"},{name:"Request Change",link:"#/request/change/"+a.restaurantId,icon:"i-pencil"}])}]),rxControllers.controller("detailCtrl",["$scope","$timeout","$upload","localStorageService","$location","$routeParams","restaurantSvr","geoLocation","reviewSvr","overviewSvr","locationSvr","photoSvr","Lightbox","userSvr","$anchorScroll","$modal","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(){a.activationForm={},a.activationForm.restaurant_id=a.restaurantId,a.user&&(a.activationForm.user_id=a.user.id)}function r(a){var b={};switch(f.request){case"validateRestaurant":b={modal:"validate",requestParam:a,templateLocation:"modules/claim/views/activation-form.html",controller:"claimCtrl"};break;case"claimRestaurant":b={modal:"claim",requestParam:a,templateLocation:"modules/claim/views/form.html",controller:"claimCtrl",windowClass:"claim-modal-window"}}return b}function s(){var b=a.restaurantId;g.getRestaurant(b).then(function(b){a.restaurant=b}),a.getPhotos(),g.getOverviews(b,a).then(function(b){a.stats=b})}function t(){a.templates=[{name:"review-widget.html",url:"modules/partials/review-widget.html"}],a.sidebar="modules/partials/sidebar-detail.html",a.header="modules/partials/header.html",a.footer="modules/partials/footer.html",a.reviewBox="modules/review/views/index.html"}var u=null;t(),o(),a.restaurantId=f.restaurantId,a.$watch("user",function(){a.isOwner=a.user&&a.user.ownedRestaurants&&_.contains(a.user.ownedRestaurants,parseInt(a.restaurantId))}),q(),a.reviewListPageChanged=function(){var b=a.reviewListCurrentPage;getReviews({page:b})},a.changeLength=function(a){a.textLength=99999},a.showPhone=function(){alert(a.restaurant.phone)},a.getPhotos=function(){l.getRestaurantPhotos(a.restaurantId).then(function(b){a.photos=b.items}),a.openLightboxModal=function(b){m.openModal(a.photos,b)}},a.onFileSelect=function(b){for(var d=0;d<b.length;d++){var e=b[d];a.upload=c.upload({url:"http://api.iresturant.com/v1/photos/upload?access-token=f899139df5e1059396431415e770c6dd",method:"POST",data:{myObj:a.myModelObj,restaurant_id:a.restaurantId,user_id:1},file:e,fileFormDataName:"data"}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a){console.log(a)})}},a.claim=function(){e.url(e.path()+"?request=claimRestaurant")},a.checkFavourite=function(){n.getFavorites().then(function(b){a.favoriteRestaurants=b,a.isFavourite=!1,angular.forEach(b,function(b){b.id==a.restaurantId&&(a.isFavourite=!0)})})},a.checkFavourite(),a.favourite=function(){a.isFavourite?n.removeFavorite(a.restaurantId):n.addFavorite(a.user.id,a.restaurant.id),a.isFavourite=!a.isFavourite};var u=r(f.request);void 0!==typeof u&&Object.keys(u).length&&a.user&&(u=p.open({templateUrl:u.templateLocation,scope:a,controller:u.controller,windowClass:u.windowClass||""}),u.opened.then(function(){a.showModal=!0,$(".overlay-main").css("display","block")}),u.result.then(function(b){a.selected=b},function(){$(".overlay-main").css("display","none")})),d.get("latitude")&&d.get("longitude")?s():(h.getLocation().then(function(a){d.add("latitude",a.coords.latitude),d.add("longitude",a.coords.longitude),s()}),s())}]),rxControllers.controller("graphCtrl",["$scope","restaurantSvr","$routeParams",function(a,b,c){a.restaurantId=c.restaurantId,a.graphDurations=[{label:"Last 7 Days",value:"WEEKLY"},{label:"Last Month",value:"MONTHLY"},{label:"Last Year",value:"YEARLY"},{label:"Overall",value:"OVERALL"},{label:"Custom Period",value:""}],a.graphDuration=a.graphDurations[3],a.setGraphDuration=function(b){if(b.value in a.graphs){a.graphDuration=b;var c=a.graphs[b.value];a.flotDataset[0].data=c.percentile,a.flotDataset[1].data=c.trend,a.donutDataset=c.source,a.stats=c.stats}},a.getGraphs=function(c){var d=a.graphDurations;if(c)d=[c];else{if(!a.dates.start.date||!a.dates.start.date)return;a.graphs={},a.noGraphs=!0}angular.forEach(d,function(c){b.getGraphs(a.restaurantId,c.value,a.dates.start.date,a.dates.end.date).then(function(b){b.percentile&&b.percentile.length>1&&(a.graphs[c.value]=b,a.noGraphs=!1,a.setGraphDuration(a.graphDuration))})})},a.donutDataset=[],a.flotDataset=[{data:[],label:" Overview",lines:{show:!1},splines:{show:!0,tension:.4,lineWidth:1,fill:.4},points:{radius:0,show:!0},shadowSize:2},{data:[],label:" Trend",dashes:{show:!0,dashLength:3,lineWidth:1},points:{radius:0,show:!0},shadowSize:2}],a.flotOptions={grid:{hoverable:!0,clickable:!0,tickColor:"#d9dee9",borderColor:"#d9dee9",borderWidth:1,color:"#555"},colors:["#19b39b","#2e7bad"],xaxis:{mode:"time"},yaxis:{ticks:4},tooltip:!0,tooltipOpts:{content:function(a,b,c,d){var e=new Date(b),f=$.plot.formatDate(e,"%Y-%m-%d"),g=d.dataIndex-1,h="";if(g>=0){var i=d.series.data[g][1],j=c-i;j>=.1?h="up by "+j.toFixed(1)+"%":-.1>=j&&(h="down by "+(-j).toFixed(1)+"%")}return Math.round(c)+"% at "+f+" "+h},defaultTheme:!1,shifts:{x:0,y:20},lines:{track:!0}},legend:{}},a.donutOptions={series:{pie:{innerRadius:.5,radius:.9,show:!0,stroke:{width:0},label:{show:!1,threshold:.05}}},colors:["#65b5c2","#4da7c1","#3993bb","#2e7bad","#23649e"],grid:{hoverable:!0,clickable:!1},tooltip:!0,tooltipOpts:{content:"%s"}};var d=new Date;a.dates={start:{date:new Date(d.getFullYear()-1,d.getMonth(),d.getDate())},end:{date:d},today:d},a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),a.dates.start.opened=!1,a.dates.end.opened=!1,a.dates[c].opened=!0},a.getGraphs()}]),rxControllers.controller("reviewCtrl",["$scope","localStorageService","$routeParams","reviewSvr","$modal","messageCenterService","$timeout",function(a,b,c,d,e,f,g){function h(){j.close(""),$(".overlay-main").css("display","none"),a.reviewListPageChanged(a.reviewListCurrentPage),i()}function i(){a.reviewForm={},a.reviewForm.restaurant_id=c.restaurantId}a.reviewForm={},a.reviewForm.restaurant_id=c.restaurantId,a.percent=0,a.max=5;var j=null;a.submitReview=function(){return a.reviewForm.rating?void d.postRestaurantReview(a.reviewForm).then(function(a){return a.err?void a.data.forEach(function(a){f.add("danger",a.message,{timeout:3e3})}):void(a.status<400?(f.add("success","Your review has been posted successfully.",{timeout:3e3}),g(h,3e3)):i())}):void f.add("danger","Please choose a rating.",{timeout:3e3})},a.hoveringOver=function(b){a.percent=100*(b/a.max)},a.addNewReview=function(){j=e.open({templateUrl:"modules/review/views/form.html",scope:a}),j.opened.then(function(){a.showModal=!0,$(".overlay-main").css("display","block")}),j.result.then(function(b){a.selected=b},function(){$(".overlay-main").css("display","none")})},a.reviewListPageChanged=function(b){a.getReviews({page:b})},a.getReviews=function(b){d.getRestaurantReviews(c.restaurantId,b).then(function(b){a.reviews={items:b.items},a.maxSize=6,a.reviewListItemPerPage=8,a.reviewListTotalItems=b._meta.totalCount,a.reviewListCurrentPage=b._meta.currentPage,a.numPages=b._meta.pageCount})},a.getReviews()}]),rxControllers.controller("loginCtrl",["$scope","$location","$rootScope","loginSvr","AuthenticationService","messageCenterService","localStorageService",function(a,b,c,d,e,f,g){function h(a,b){var c="";return c="signup"==a&&422==b?"Please provide correct information. Thank you.":"Something went wrong ! Please try again later."}a.navbarConfig={hideButtons:!0},a.credentials="",a.signup={},a.login=function(f){f&&d.authenticate(a.credentials).then(function(a){return a.err?(g.remove("token"),g.remove("user"),e.isLogged=0,c.isLogged=!1,void delete c.user):(e.isLogged=!0,c.isLogged=!0,g.set("token",a.items.accessToken),g.set("user",{id:a.items.id,username:a.items.username,email:a.items.email,ownsRestaurants:a.items.details.owned_restaurants&&a.items.details.owned_restaurants.length,ownedRestaurants:a.items.details.owned_restaurants||[]}),c.user=g.get("user"),void b.path("/index"))})},a.signupUser=function(b){b&&d.signup(a.signup).then(function(a){if(a.err){var b=h("signup",a.status);return void f.add("danger",b,{timeout:3e3})}f.add("success","Thank you for registration.")})}}]),rxControllers.controller("photoCtrl",["$scope","$routeParams","photoSvr","messageCenterService","localStorageService","$rootScope","$location",function(a,b,c){function d(b){return"undefined"==typeof b&&(b={page:1}),c.getRestaurantPhotos(a.restaurantId,b).then(function(b){return a.photos=b.items,a.maxSize=6,a.photosListItemPerPage=8,a.photosListTotalItems=b._meta.totalCount,a.photosListCurrentPage=b._meta.currentPage,!0})}a.restaurantId=b.restaurantId,a.dynamic="",a.type="",d(),a.photosListPageChanged=function(){var b=a.photosListCurrentPage;d({page:b})},a.deletePhoto=function(b){var d=a.photos.indexOf(b);a.photos[d].request=!0,c.deleteRestaurantPhotos(b).then(function(){d>-1&&a.photos.splice(d,1)})},a.$watch("restaurantPhotos",function(b){if(a.type="warning",b)for(var e=0;e<b.length;e++){var f=b[e],g={data:f,restaurant_id:a.restaurantId,user_id:a.user.id};c.uploadRestaurantPhoto(g).then(function(b){if(b.items.success){var c=a.photosListCurrentPage;d({sort:"popular",page:c}).then(function(){a.dynamic=100,a.type="success"})}},function(){a.type="danger"})}})}]),rxControllers.controller("compareCtrl",["$scope","$routeParams","restaurantSvr",function(a,b,c){a.user&&a.user.ownedRestaurants&&a.user.ownedRestaurants.length&&c.getRestaurants({"id-in":a.user.ownedRestaurants.join(),"per-page":50}).then(function(b){a.restaurants=[],angular.forEach(b.items,function(b){a.addRestaurant(b)})}),a.removeRestaurant=function(b){a.restaurants=_.without(a.restaurants,b),delete a.graphs[b.id],a.refreshGraphs(a.graphDuration)},a.graphs={},a.haveGraphs={};var d=new Date;a.dates={start:{date:new Date(d.getFullYear()-1,d.getMonth(),d.getDate())},end:{date:d},today:d},a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),a.dates.start.opened=!1,a.dates.end.opened=!1,a.dates[c].opened=!0},a.graphDurations=[{label:"Last 7 Days",value:"WEEKLY"},{label:"Last Month",value:"MONTHLY"},{label:"Last Year",value:"YEARLY"},{label:"Overall",value:"OVERALL"},{label:"Custom Period",value:""}],a.graphDuration=a.graphDurations[2],a.setGraphDuration=function(b){a.graphDuration=b,""==b.value?a.updateCustomPeriodGraphs():a.refreshGraphs(b)},a.refreshGraphs=function(b){a.flotDataset=[],angular.forEach(a.graphs,function(c){var d=c[b.value];d&&a.flotDataset.push({data:d.trend||[],label:" "+d.restaurant.name,restaurantId:d.restaurant.id,lines:{show:!1},splines:{show:!0,tension:.4,lineWidth:2,fill:!1},points:{radius:0,show:!0},shadowSize:2,color:d.restaurant.color})})},a.updateCustomPeriodGraphs=function(){angular.forEach(a.restaurants,function(b){c.getGraphs(b.id,"",a.dates.start.date,a.dates.end.date).then(function(c){c.restaurant=b,delete a.graphs[b.id][""],a.graphs[b.id][""]=c,a.refreshGraphs(a.graphDuration)})})},a.addGraph=function(b){var d=a.graphDurations;angular.forEach(d,function(d){c.getGraphs(b.id,d.value,a.dates.start.date,a.dates.end.date).then(function(c){c.restaurant=b,c.percentile&&c.percentile.length&&(a.haveGraphs[d.value]=!0,a.graphs[b.id]||(a.graphs[b.id]={}),a.graphs[b.id][d.value]=c,a.refreshGraphs(a.graphDuration))})})},a.addItem=function(b){a.addRestaurant(b.data)},a.addRestaurant=function(b){Object.keys(b).length&&(a.numAdded=(a.numAdded||0)+1,b.color=a.flotColors[a.numAdded%a.flotColors.length],a.restaurants.push(b),a.addGraph(b))},a.setStrong=function(b,c){for(var d=a.flotDataset,e=0;e<d.length;e++)if(d[e].restaurantId==b.id)return void(c?(d[e].splines.lineWidth=3,d[e].points.radius=2):(d[e].splines.lineWidth=2,d[e].points.radius=0))},a.flotDataset=[],a.flotColors=["#1F2D6D","#4897C3","#B75E8F","#BF1E10","#D8C746","#2F9630"],a.flotOptions={grid:{hoverable:!0,clickable:!0,tickColor:"#d9dee9",borderColor:"#d9dee9",borderWidth:1,color:"#555"},xaxis:{mode:"time"},yaxis:{ticks:4},tooltip:!0,tooltipOpts:{content:function(a,b,c,d){var e=new Date(b),f=$.plot.formatDate(e,"%Y-%m-%d"),g=d.dataIndex-1,h="";if(g>=0){var i=d.series.data[g][1],j=c-i;j>=.1?h="up by "+j.toFixed(1)+"%":-.1>=j&&(h="down by "+(-j).toFixed(1)+"%")}return Math.round(c)+"% at "+f+" "+h},defaultTheme:!1,shifts:{x:0,y:20},lines:{track:!0}},legend:{show:!0,noColumns:5}}}]),rxControllers.controller("widgetsCtrl",["$scope","$routeParams","restaurantSvr",function(a,b,c){a.options={restaurantId:0,ratingLessThan:4,hideOnRatingLessThan:!1,hideOnTrendNegative:!1,restaurantName:"No restaurant selected",width:"160px"},a.setRestaurant=function(b){b&&b.id&&(a.options.restaurantId=b.id,a.options.restaurantName=b.name,c.getRestaurants({"id-in":b.id}).then(function(b){var c=b.items[0],d=Math.round(c.overview__percentile/10)/2;1>d&&(d=1);var e=Math.trunc(d),f=0;d-e>0&&(f=5),a.options.ratingWhole=e,a.options.ratingHalf=f,a.options.reviews_str=1==c.overview__total_reviews?"1 review":c.overview__total_reviews+" reviews",a.options.trend_change=c.trend_change,a.options.current_trend_change=c.trend_change>=0?"+ "+c.trend_change_abs:"- "+c.trend_change_abs,a.options.trend_change_abs=c.trend_change_abs,a.options.current_trend_change_color=a.options.trend_change>0?"#5cb85c":a.options.trend_change<0?"#f0ad4e":"#92B1BB"}))},a.$watch("options",function(){var b="";a.options.hideOnRatingLessThan&&(b=",\n    hideIfRatingLessThan: "+a.options.ratingLessThan);var c="";a.options.hideOnTrendNegative?c=",\n    hideOnTrendNegative: true\n":b+=" \n",a.snippet='<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script> \n<script src="'+a.baseUrl+'modules/widget/rating_widget.js"></script> \n<div id="ir-widget"></div> \n<script> \n  irRatingWidget({ \n    container: "#ir-widget", \n    restaurantId: '+a.options.restaurantId+b+c+"  });\n</script>"},!0)}]),rxControllers.controller("claimCtrl",["$scope","$modal","$routeParams","$timeout","messageCenterService","claimSvr","localStorageService",function(a,b,c,d,e,f){function g(){a.claimForm={},a.activationForm={},a.claimForm.restaurant_id=c.restaurantId,a.claimForm.user_id=a.user.id}g();a.claimRestaurant=function(){f.claimRestaurant(a.claimForm).then(function(a){return a.err&&a.data?void a.data.forEach(function(a){e.add("danger",a.message,{timeout:3e3})}):a.err?void e.add("danger",a.message,{timeout:3e3}):void(a.status<400?($(".overlay-main").css("display","none"),$(".modal-dialog").css("display","none"),e.add("success","Your access code has been sent to your email. Your request-token is "+a.data.request_token)):g())})},a.verifyRestaurant=function(){f.verifyRestaurant(a.activationForm).then(function(a){return a.err?void a.data.forEach(function(a){e.add("danger",a.message,{timeout:3e3})}):void(a.status<400?e.add("success","Congratulations! you have owned restaurant dashboard. Enjoy, exploring all new and exciting features."):g())})}}]),rxControllers.controller("requestCtrl",["$scope","$routeParams","requestSvr","messageCenterService","localStorageService",function(a,b,c,d){a.restaurantId=b.restaurantId,a.request={},a.submitRequest=function(){return a.request.restaurant_id=a.restaurantId,c.postRestaurantInfoRequest(a.request).then(function(a){a.status<400&&d.add("success","Your request has been sent for processing.",{timeout:3e3})}),!1}}]);var directiveMod=angular.module("directive",[]);directiveMod.directive("showRating",function(){var a={link:function(a,b,c){for(var d=Math.round(c.value),e=5,f="",g=0;d>g;g++)f+='<span class="glyphicon glyphicon-star"></span>';for(var g=0;e-d>g;g++)f+='<span class="glyphicon glyphicon-star-empty"></span>';b.html(f)}};return a}),angular.module("directive",["restaurantService"]).directive("searchBox",["restaurantSvr",searchBox]).directive("shareLinks",["$location",shareLinks]);var claimService=angular.module("claimService",[]);claimService.factory("claimSvr",["Restangular",function(a){return{claimRestaurant:function(b){var c=a.all("claims"),d=$.param(b);return c.post(d,{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return a},function(a){return a.err=!0,a})},verifyRestaurant:function(b){var c=a.all("claims/verify"),d={"request-token":b.request_token,"validation-key":b.validation_key},e=$.param(d);return c.post(e,{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return a},function(a){return a.err=!0,a})}}}]);var restaurantService=angular.module("restaurantService",[]);restaurantService.factory("restaurantSvr",["localStorageService","Restangular",function(a,b){return{getRestaurants:function(c){var d=b.all("restaurants/list"),e=this;return d.getList(merge_objects({expand:"restaurantPhotos",latitude:a.get("latitude"),longitude:a.get("longitude"),page:0},c)).then(function(a){return{items:e.expandRestaurantList(a.data[0].items),_meta:a.data[0]._meta}})},expandRestaurantList:function(a){for(var b=0;b<a.length;b++){for(var c="",d=0;d<=a[b].price_range;d++)c+="$";a[b].price_range_symbol=c;var e=JSON.parse(a[b].overview__trend_series),f=[],g=[],h=0,i=0;for(var j in e){var k=e[j];for(var l in k)h+=k[l],i++}var m=h/i;for(var j in e){var k=e[j];for(var l in k)f.push([l,m-k[l]]),g.push([l,a[b].overview__percentile-k[l]])}if(a[b].trend_data=[{key:"Trend",bar:!0,values:f},{key:"Percentile",values:g}],a[b].rating=Math.round(a[b].overview__percentile/2)/10,a[b].rating_rounded=Math.round(a[b].overview__percentile/20),a[b].overview__percentile_rounded=Math.round(10*a[b].overview__percentile)/10,a[b].trend_change=0,a[b].trend_change_abs=0,e&&e.length>1){var n,o;for(var p in e[e.length-1])n=e[e.length-1][p];for(var q in e[e.length-2])o=e[e.length-2][q];a[b].trend_change=Math.round(10*(parseFloat(n)-parseFloat(o)))/10,a[b].trend_change_abs=Math.abs(a[b].trend_change)}}return a},getRestaurant:function(a){var c="restaurants/"+a,d=b.one(c);return d.get().then(function(a){for(var b=a.data,c="",d=0;d<=b.price_range;d++)c+="$";return b.price_range_symbol=c,b})},getPhotos:function(a){var c="restaurants/"+a+"/photos",d=b.all(c);return d.getList().then(function(a){return a.data[0].items})},getOverviews:function(a){var c="restaurants/"+a+"/stats",d=b.one(c);return d.get().then(function(a){return a.data.items})},getGraphs:function(a,c,d,e){var f="restaurants/"+a+"/graphs",g=b.one(f),h={};return c?h.duration=c:(h.start=d.toISOString().substring(0,10),h.end=e.toISOString().substring(0,10)),h.type="PERCENTILE-TREND-AND-SOURCE",g.get(h).then(function(a){var b=[],c=[],d=[];return angular.forEach(a.data.source,function(a,c){a&&parseInt(a)>0&&b.push({label:c,data:parseInt(a)})}),angular.forEach(a.data.data,function(a,b){c.push([parseInt(b),a.percentile])}),angular.forEach(a.data.data,function(a,b){d.push([parseInt(b),a.trend])}),{percentile:c,trend:d,source:b,stats:a.data.stats}})},getRestaurantCategories:function(){var a="restaurants/category",c=b.all(a);return c.getList().then(function(a){return a.data[0].items})},getRestaurantLocations:function(a){var c="restaurants/location",d=b.all(c);return d.getList({search:a}).then(function(a){return a.data[0].items})},findRestaurant:function(a){var c="restaurants/find",d=b.all(c);return d.getList({search:a}).then(function(a){return a.data[0].items})}}}]);var reviewService=angular.module("reviewService",[]);reviewService.factory("reviewSvr",["localStorageService","Restangular",function(a,b){return{getRestaurantReviews:function(a,c){var d=b.all("restaurants/"+a+"/reviews");return d.withHttpConfig({cache:!1}).getList(c).then(function(a){return console.log("reviewService line no 16 :: reviewService sending reviews"),{items:a.data[0].items,_meta:a.data[0]._meta}})},postRestaurantReview:function(a){var c=b.all("reviews"),d=$.param(a);return c.post(d,{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return a},function(a){return a.err=!0,a})}}}]);var overviewService=angular.module("overviewService",[]);overviewService.factory("overviewSvr",["localStorageService","Restangular",function(a,b){return{getGraph:function(a){var c="overviews/"+a+"/graph",d=b.all(c);return d.getList().then(function(a){a=a.data[0].items;var b;b=[];for(var c=0;c<a.length;c++)b[c]=a[c].percentile;return b})}}}]);var locationService=angular.module("locationService",[]);locationService.factory("locationSvr",["localStorageService","Restangular",function(a,b){return{getLocation:function(a){var c=b.one("restaurants/"+a);return c.get({expand:"locations"}).then(function(a){return a.data.locations[0]})}}}]);var photoService=angular.module("photoService",[]);
photoService.factory("photoSvr",["localStorageService","Restangular","$http",function(a,b){return{getRestaurantPhotos:function(a,c){var d="restaurants/"+a+"/photos",e=b.all(d);return e.getList(c).then(function(a){return{items:a.data[0].items,_meta:a.data[0]._meta}})},deleteRestaurantPhotos:function(a){var c=a.id,d=b.all("photos/"+c);return d.remove().then(function(a){return a})},uploadRestaurantPhoto:function(a){var c="photos/upload",d=new FormData;return angular.forEach(a,function(a,b){d.append(b,a)}),b.one(c).withHttpConfig({transformRequest:angular.identity}).customPOST(d,"",void 0,{"Content-Type":void 0}).then(function(a){return{items:a.data}})}}}]);var loginService=angular.module("Services",[]);loginService.factory("loginSvr",["Restangular",function(a){return{authenticate:function(b){b&&void 0!=b||(b={});var c=a.all("authentications/login");b.encrypted=!1;var d=$.param(b);return c.post(d,null,{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return{items:a.data.items[0],meta:a.data._meta}},function(a){return{err:1,status:a.status,statusText:a.statusText}})},signup:function(b){b&&void 0!=b||(b={});var c=a.all("authentications/register"),d=$.param(b);return c.post(d,null,{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return{status:a.status}},function(a){return{err:1,status:a.status,statusText:a.statusText}})}}}]);var requestService=angular.module("requestService",[]);requestService.factory("requestSvr",["localStorageService","Restangular",function(a,b){return{postRestaurantInfoRequest:function(a){var c=b.all("requests"),d=$.param(a);return c.post(d,{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return a},function(a){return a.err=!0,a})}}}]);var userService=angular.module("userService",[]);userService.factory("userSvr",["Restangular","restaurantSvr",function(a,b){return{getFavorites:function(){return a.one("users/favourites").withHttpConfig({cache:!1}).get({expand:"restaurantPhotos"}).then(function(a){var c=a.data.items;return b.expandRestaurantList(c)})},addFavorite:function(b,c){var d=a.all("favourites"),e=$.param({user_id:b,restaurant_id:c});return d.post(e,{},{"Content-Type":"application/x-www-form-urlencoded"}).then(function(a){return a})},removeFavorite:function(b){var c=a.all("favourites/restaurant/"+b);return c.remove().then(function(a){return a})}}}]),+function(a){a(function(){function b(b){var c=a(".nav-user"),d=a(".count:first",c),e=parseInt(d.text());a(".count",c).fadeOut().fadeIn().text(e+1),a(b).hide().prependTo(c.find(".list-group")).slideDown().css("display","block")}a(".datepicker-input").each(function(){a(this).datepicker()}),a(".dropfile").each(function(){var b=a(this);return"undefined"==typeof window.FileReader?void a("small",this).html("File API & FileReader API not supported").addClass("text-danger"):(this.ondragover=function(){return b.addClass("hover"),!1},this.ondragend=function(){return b.removeClass("hover"),!1},void(this.ondrop=function(c){c.preventDefault(),b.removeClass("hover").html("");var d=c.dataTransfer.files[0],e=new FileReader;return e.onload=function(c){b.append(a("<img>").attr("src",c.target.result))},e.readAsDataURL(d),!1}))}),a(".slider").each(function(){a(this).slider()}),a.fn.sortable&&a(".sortable").sortable(),a(".no-touch .slim-scroll").each(function(){var b,c=a(this),d=c.data();c.slimScroll(d),a(window).resize(function(){clearTimeout(b),b=setTimeout(function(){c.slimScroll(d)},500)}),a(document).on("updateNav",function(){c.slimScroll(d)})}),a(".portlet").each(function(){a(".portlet").sortable({connectWith:".portlet",iframeFix:!1,items:".portlet-item",opacity:.8,helper:"original",revert:!0,forceHelperSize:!0,placeholder:"sortable-box-placeholder round-all",forcePlaceholderSize:!0,tolerance:"pointer"})}),a("#docs pre code").each(function(){var b=a(this),c=b.html();b.html(c.replace(/</g,"&lt;").replace(/>/g,"&gt;"))}),a(document).on("change",'table thead [type="checkbox"]',function(b){b&&b.preventDefault();var c=a(b.target).closest("table"),d=a(b.target).is(":checked");a('tbody [type="checkbox"]',c).prop("checked",d)});var c='<a href="#" class="media list-group-item"><span class="pull-left thumb-sm text-center"><i class="fa fa-envelope-o fa-2x text-success"></i></span><span class="media-body block m-b-none">Sophi sent you a email<br><small class="text-muted">1 minutes ago</small></span></a>';setTimeout(function(){b(c)},1500),a(".chosen-select").length&&a(".chosen-select").chosen()})}(window.jQuery),function(a,b,c){function d(a){var b={},d=/^jQuery\d+$/;return c.each(a.attributes,function(a,c){c.specified&&!d.test(c.name)&&(b[c.name]=c.value)}),b}function e(a,d){var e=this,f=c(e);if(e.value==f.attr("placeholder")&&f.hasClass("placeholder"))if(f.data("placeholder-password")){if(f=f.hide().next().show().attr("id",f.removeAttr("id").data("placeholder-id")),a===!0)return f[0].value=d;f.focus()}else e.value="",f.removeClass("placeholder"),e==b.activeElement&&e.select()}function f(){var a,b=this,f=c(b),g=this.id;if(""==b.value){if("password"==b.type){if(!f.data("placeholder-textinput")){try{a=f.clone().attr({type:"text"})}catch(h){a=c("<input>").attr(c.extend(d(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":f,"placeholder-id":g}).bind("focus.placeholder",e),f.data({"placeholder-textinput":a,"placeholder-id":g}).before(a)}f=f.removeAttr("id").hide().prev().attr("id",g).show()}f.addClass("placeholder"),f[0].value=f.attr("placeholder")}else f.removeClass("placeholder")}var g,h,i="placeholder"in b.createElement("input"),j="placeholder"in b.createElement("textarea"),k=c.fn,l=c.valHooks,m=c.propHooks;i&&j?(h=k.placeholder=function(){return this},h.input=h.textarea=!0):(h=k.placeholder=function(){var a=this;return a.filter((i?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder"),a},h.input=i,h.textarea=j,g={get:function(a){var b=c(a),d=b.data("placeholder-password");return d?d[0].value:b.data("placeholder-enabled")&&b.hasClass("placeholder")?"":a.value},set:function(a,d){var g=c(a),h=g.data("placeholder-password");return h?h[0].value=d:g.data("placeholder-enabled")?(""==d?(a.value=d,a!=b.activeElement&&f.call(a)):g.hasClass("placeholder")?e.call(a,!0,d)||(a.value=d):a.value=d,g):a.value=d}},i||(l.input=g,m.value=g),j||(l.textarea=g,m.value=g),c(function(){c(b).delegate("form","submit.placeholder",function(){var a=c(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),c(a).bind("beforeunload.placeholder",function(){c(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery),window.Modernizr=function(a,b,c){function d(a){o.cssText=a}function e(a,b){return typeof a===b}var f,g,h,i="2.6.2",j={},k=!0,l=b.documentElement,m="modernizr",n=b.createElement(m),o=n.style,p=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),q={},r=[],s=r.slice,t=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,n=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:m+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',m,'">',a,"</style>"].join(""),j.id=m,(k?j:n).innerHTML+=f,n.appendChild(j),k||(n.style.background="",n.style.overflow="hidden",i=l.style.overflow,l.style.overflow="hidden",l.appendChild(n)),g=c(j,a),k?j.parentNode.removeChild(j):(n.parentNode.removeChild(n),l.style.overflow=i),!!g},u={}.hasOwnProperty;h=e(u,"undefined")||e(u.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return u.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=s.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(s.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(s.call(arguments)))};return d}),q.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:t(["@media (",p.join("touch-enabled),("),m,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c};for(var v in q)h(q,v)&&(g=v.toLowerCase(),j[g]=q[v](),r.push((j[g]?"":"no-")+g));return j.addTest=function(a,b){if("object"==typeof a)for(var d in a)h(a,d)&&j.addTest(d,a[d]);else{if(a=a.toLowerCase(),j[a]!==c)return j;b="function"==typeof b?b():b,"undefined"!=typeof k&&k&&(l.className+=" "+(b?"":"no-")+a),j[a]=b}return j},d(""),n=f=null,j._version=i,j._prefixes=p,j.testStyles=t,l.className=l.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(k?" js "+r.join(" "):""),j}(this,this.document),Modernizr.addTest("android",function(){return!!navigator.userAgent.match(/Android/i)}),Modernizr.addTest("chrome",function(){return!!navigator.userAgent.match(/Chrome/i)}),Modernizr.addTest("firefox",function(){return!!navigator.userAgent.match(/Firefox/i)}),Modernizr.addTest("iemobile",function(){return!!navigator.userAgent.match(/IEMobile/i)}),Modernizr.addTest("ie",function(){return!!navigator.userAgent.match(/MSIE/i)}),Modernizr.addTest("ie8",function(){return!!navigator.userAgent.match(/MSIE 8/i)}),Modernizr.addTest("ie10",function(){return!!navigator.userAgent.match(/MSIE 10/i)}),Modernizr.addTest("ie11",function(){return!!navigator.userAgent.match(/Trident.*rv:11\./)}),Modernizr.addTest("ios",function(){return!!navigator.userAgent.match(/iPhone|iPad|iPod/i)}),function(a,b){var c="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,d=function(){for(var a,c,d=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"]],e=0,f=d.length,g={};f>e;e++)if(a=d[e],a&&a[1]in b){for(e=0,c=a.length;c>e;e++)g[d[0][e]]=a[e];return g}return!1}(),e={request:function(a){var e=d.requestFullscreen;a=a||b.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?a[e]():a[e](c&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){b[d.exitFullscreen]()},toggle:function(a){this.isFullscreen?this.exit():this.request(a)},onchange:function(){},onerror:function(){},raw:d};return d?(Object.defineProperties(e,{isFullscreen:{get:function(){return!!b[d.fullscreenElement]}},element:{enumerable:!0,get:function(){return b[d.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!b[d.fullscreenEnabled]}}}),b.addEventListener(d.fullscreenchange,function(a){e.onchange.call(e,a)}),b.addEventListener(d.fullscreenerror,function(a){e.onerror.call(e,a)}),void(a.screenfull=e)):a.screenfull=!1}(window,document),+function(a){var b=function(b){this.$element=a(b),this.$prev=this.$element.prev(),!this.$prev.length&&(this.$parent=this.$element.parent())};b.prototype={constructor:b,init:function(){var a=this.$element,b=a.data().toggle.split(":")[1],c=a.data("target");a.hasClass("in")||a[b](c).addClass("in")},reset:function(){this.$parent&&this.$parent.prepend(this.$element),!this.$parent&&this.$element.insertAfter(this.$prev),this.$element.removeClass("in")}},a.fn.shift=function(c){return this.each(function(){var d=a(this),e=d.data("shift");e||d.data("shift",e=new b(this)),"string"==typeof c&&e[c]()})},a.fn.shift.Constructor=b}(jQuery),+function(a){var b=function(b,c){this.options=c,this.$element=a(b),this.start()};b.DEFAULTS={backdrop:!0,url:""},b.prototype.start=function(){var b=this;this.backdrop(),a.ajax(this.options.url).done(function(a){b.$content=a,b.complete()})},b.prototype.complete=function(){try{window.history.pushState({},"",this.options.url)}catch(a){window.location.replace(this.options.url)}this.updateBar(100)},b.prototype.backdrop=function(){this.$element.css("position","relative"),this.$backdrop=a('<div class="backdrop fade"></div>').appendTo(this.$element),this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),this.$bar=a('<div class="bar b-t b-info"></div>').width(0).appendTo(this.$backdrop)},b.prototype.update=function(){!this.$element.is("html")&&this.$element.html(this.$content),this.$element.is("html")&&(document.open(),document.write(this.$content),document.close())},b.prototype.updateBar=function(a){var b=this;this.$bar.stop().animate({width:a+"%"},500,"linear",function(){100==a&&b.update()})},b.prototype.enable=function(a){var b=a.currentTarget;return location.protocol!==b.protocol||location.hostname!==b.hostname?!1:b.hash&&b.href.replace(b.hash,"")===location.href.replace(location.hash,"")?!1:b.href===location.href+"#"||b.href===location.href?!1:!0},a.fn.bjax=function(c){return this.each(function(){var d=a(this),e=d.data("app.bjax"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c);e||d.data("app.bjax",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.bjax.Constructor=b,a(window).on("popstate",function(a){null!==a.originalEvent.state&&window.location.reload(!0),a.preventDefault()}),a(document).on("click.app.bjax.data-api","[data-bjax], .nav-primary a",function(c){if(b.prototype.enable(c)){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||"html"),g=a.extend({url:e},f.data(),d.data());f.bjax(g),c.preventDefault()}})}(jQuery),Date.now=Date.now||function(){return+new Date},+function(a){a(function(){a(document).on("click","[data-toggle=fullscreen]",function(a){a.preventDefault(),screenfull.enabled&&screenfull.request()}),a("input[placeholder], textarea[placeholder]").placeholder(),a("[data-toggle=popover]").popover(),a(document).on("click",".popover-title .close",function(b){var c=a(b.target),d=c.closest(".popover").prev();d&&d.popover("hide")}),a(document).on("click",'[data-toggle="ajaxModal"]',function(b){a("#ajaxModal").remove(),b.preventDefault();var c=a(this),d=c.data("remote")||c.attr("href"),e=a('<div class="modal fade" id="ajaxModal"><div class="modal-body"></div></div>');a("body").append(e),e.modal(),e.load(d)}),a.fn.dropdown.Constructor.prototype.change=function(b){b.preventDefault();var c,d,e,f=a(b.target),g=!1;!f.is("a")&&(f=f.closest("a")),d=f.closest(".dropdown-menu"),e=d.parent().find(".dropdown-label"),$labelHolder=e.text(),c=f.find("input"),g=c.is(":checked"),c.is(":disabled")||"radio"==c.attr("type")&&g||("radio"==c.attr("type")&&d.find("li").removeClass("active"),f.parent().removeClass("active"),!g&&f.parent().addClass("active"),c.prop("checked",!c.prop("checked")),$items=d.find("li > a > input:checked"),$items.length?($text=[],$items.each(function(){var b=a(this).parent().text();b&&$text.push(a.trim(b))}),$text=$text.length<4?$text.join(", "):$text.length+" selected",e.html($text)):e.html(e.data("placeholder")))},a(document).on("click.dropdown-menu",".dropdown-select > li > a",a.fn.dropdown.Constructor.prototype.change),a("[data-toggle=tooltip]").tooltip(),a(document).on("click",'[data-toggle^="class"]',function(b){b&&b.preventDefault();var c,d,e,f,g,h=a(b.target);!h.data("toggle")&&(h=h.closest('[data-toggle^="class"]')),c=h.data().toggle,d=h.data("target")||h.attr("href"),c&&(e=c.split(":")[1])&&(f=e.split(",")),d&&(g=d.split(",")),f&&f.length&&a.each(g,function(b){if(-1!==f[b].indexOf("*")){var c=new RegExp("\\s"+f[b].replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g");a(h).each(function(b,d){for(var e=" "+d.className+" ";c.test(e);)e=e.replace(c," ");d.className=a.trim(e)})}"#"!=g[b]&&a(g[b]).toggleClass(f[b])||h.toggleClass(f[b])}),h.toggleClass("active")}),a(document).on("click",".panel-toggle",function(b){b&&b.preventDefault();var c,d=a(b.target),e="collapse";d.is("a")||(d=d.closest("a")),c=d.closest(".panel"),c.find(".panel-body").toggleClass(e),d.toggleClass("active")}),a(".carousel.auto").carousel(),a(document).on("click.button.data-api","[data-loading-text]",function(b){var c=a(b.target);c.is("i")&&(c=c.parent()),c.button("loading")});var b=a(window),c=function(b){return"reset"==b?(a('[data-toggle^="shift"]').shift("reset"),!0):(a('[data-toggle^="shift"]').shift("init"),!0)};b.width()<768&&c();var d;b.resize(function(){clearTimeout(d),d=setTimeout(function(){e(),b.width()<767&&c(),b.width()>=768&&c("reset")&&f()},500)});var e=function(){return a(".app-fluid #nav > *").css("min-height",a(window).height()-60),!0};e();var f=function(){return a(".ie11 .vbox").each(function(){a(this).height(a(this).parent().height())}),!0};f(),a(document).on("click",'[data-ride="collapse"] a',function(b){var c,d=a(b.target);d.is("a")||(d=d.closest("a")),c=d.parent().siblings(".active"),c&&c.toggleClass("active").find("> ul:visible").slideUp(200),d.parent().hasClass("active")&&d.next().slideUp(200)||d.next().slideDown(200),d.parent().toggleClass("active"),d.next().is("ul")&&b.preventDefault(),setTimeout(function(){a(document).trigger("updateNav")},300)}),a(document).on("click.bs.dropdown.data-api",".dropdown .on, .dropup .on, .open .on",function(a){a.stopPropagation()})})}(jQuery);var myApp=angular.module("myApp",["ngRoute","config","LocalStorageModule","directive","restangular","geoLocation","overviewService","restaurantService","reviewService","locationService","photoService","requestService","claimService","userService","GoogleMaps","angularFileUpload","ui.bootstrap","nvd3ChartDirectives","easypiechart","highcharts-ng","angular-flot","Controllers","Services","MessageCenterModule","angularFileUpload","uiGmapgoogle-maps","cgBusy","bootstrapLightbox"]);myApp.config(["$routeProvider",function(a){a.otherwise({redirectTo:"/index"})}]),myApp.config(["uiGmapGoogleMapApiProvider",function(a){a.configure({v:"3.17",libraries:"weather,geometry,visualization"})}]),myApp.config(["RestangularProvider",function(a){a.setRestangularFields({id:"id"}),a.setBaseUrl("http://api.reviews-combined.com:80/v1/"),a.setDefaultRequestParams({"access-token":"f899139df5e1059396431415e770c6dd","per-page":8}),a.setDefaultHttpFields({withCredentials:!1,cache:!0}),a.setFullResponse(!0),a.setRequestInterceptor(function(a,b){return"remove"===b?null:a}),a.addResponseInterceptor(function(a,b){return"getList"===b&&(a=[{items:a.items,_meta:a._meta}]),a})}]),myApp.factory("AuthenticationService",function(){var a={isLogged:!1};return a}),myApp.run(["$rootScope","$location","localStorageService","AuthenticationService",function(a,b,c,d){a.$on("$routeChangeStart",function(a,e){null==e||null==e.access||!e.access.requiredLogin||d.isLogged||c.get("token")||(d.isLogged=0,b.path("/login"))}),a.clearToken=function(){c.remove("token"),c.remove("user"),a.isLogged=!1,delete a.user,b.path("/index")},a.user=c.get("user"),a.baseUrl="http://dev2.reviews-combined.com/"}]),myApp.config(["$httpProvider","RestangularProvider",function(a,b){function c(a){switch(a){case"Invalid username":a="The username you provided does not exist.";break;case"Invalid password":a="Sorry ! the password did not match. Please try again.";break;default:a=a}return a}a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"];var d=["$q","$location","$injector","$rootScope","localStorageService","AuthenticationService","messageCenterService",function(a,d,e,f,g,h,i){return{request:function(a){a.headers=a.headers||{};var c=g.get("token");return c&&(b.setDefaultRequestParams({"access-token":c,"per-page":8}),h.isLogged=1,f.isLogged=1),a},requestError:function(b){return a.reject(b)},response:function(b){return b||a.when(b)},responseError:function(b){var h=e.get("AuthenticationService"),j=g.get("token");if(null!=b&&401===b.status&&(j||h.isLogged))g.remove("token"),h.isLogged=!1,f.isLogged=!1,d.path("/login");else if(0===b.status)f.errorStatus="No connection. Verify application is running.";else if(401==b.status)f.errorStatus="Unauthorized";else if(405==b.status)f.errorStatus="HTTP verb not supported [405]";else{if(422!=b.status||!b.data.message)return void b.data.forEach(function(a){i.add("danger",c(a.message),{timeout:3e3})});f.errorStatus=c(b.data.message)}return f.errorStatus?void i.add("danger",f.errorStatus,{timeout:3e3}):a.reject(b)}}}];a.interceptors.push(d)}]);